<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content="Alberto Huélamo ">
<meta name=description content="Photo by Joey Banks in Unsplash
  I bought an M1 Mac Mini, and I have been using it as my main personal desktop — games aside — for the last months. I&amp;rsquo;m extreamly pleased with this machine: it&amp;rsquo;s small, it feels fast and snappy, it&amp;rsquo;s quiet — I have never ever heard the fans — and its power consumption is very low.
Apple&amp;rsquo;s plan is to carry out a 2-year transition from November 2020 to replace its Intel-based Macs by M-something ones.">
<meta name=keywords content=",mac,jvm,jdk,sdkman,scala,sbt">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=https://alhuelamo.com/posts/2021/11/native-apple-silicon-jdks/>
<title>
Native Apple Silicon JDKs :: Alberto Huélamo
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=/main.17863a81d979b637a02cd7632a4d86e9d80563ef460fd6af1a56962efcaa066b.css>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=/favicon.ico>
<meta name=msapplication-TileColor content>
<meta name=theme-color content>
<meta itemprop=name content="Native Apple Silicon JDKs">
<meta itemprop=description content="Photo by Joey Banks in Unsplash
  I bought an M1 Mac Mini, and I have been using it as my main personal desktop — games aside — for the last months. I&rsquo;m extreamly pleased with this machine: it&rsquo;s small, it feels fast and snappy, it&rsquo;s quiet — I have never ever heard the fans — and its power consumption is very low.
Apple&rsquo;s plan is to carry out a 2-year transition from November 2020 to replace its Intel-based Macs by M-something ones."><meta itemprop=datePublished content="2021-11-29T12:45:14+01:00">
<meta itemprop=dateModified content="2021-11-29T12:45:14+01:00">
<meta itemprop=wordCount content="1170"><meta itemprop=image content="https://alhuelamo.com/">
<meta itemprop=keywords content="mac,jvm,jdk,sdkman,scala,sbt,">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://alhuelamo.com/">
<meta name=twitter:title content="Native Apple Silicon JDKs">
<meta name=twitter:description content="Photo by Joey Banks in Unsplash
  I bought an M1 Mac Mini, and I have been using it as my main personal desktop — games aside — for the last months. I&rsquo;m extreamly pleased with this machine: it&rsquo;s small, it feels fast and snappy, it&rsquo;s quiet — I have never ever heard the fans — and its power consumption is very low.
Apple&rsquo;s plan is to carry out a 2-year transition from November 2020 to replace its Intel-based Macs by M-something ones.">
<meta property="og:title" content="Native Apple Silicon JDKs">
<meta property="og:description" content="Photo by Joey Banks in Unsplash
  I bought an M1 Mac Mini, and I have been using it as my main personal desktop — games aside — for the last months. I&rsquo;m extreamly pleased with this machine: it&rsquo;s small, it feels fast and snappy, it&rsquo;s quiet — I have never ever heard the fans — and its power consumption is very low.
Apple&rsquo;s plan is to carry out a 2-year transition from November 2020 to replace its Intel-based Macs by M-something ones.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://alhuelamo.com/posts/2021/11/native-apple-silicon-jdks/"><meta property="og:image" content="https://alhuelamo.com/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-29T12:45:14+01:00">
<meta property="article:modified_time" content="2021-11-29T12:45:14+01:00"><meta property="og:site_name" content="Alberto Huélamo">
<meta property="article:section" content="tooling">
<meta property="article:published_time" content="2021-11-29 12:45:14 +0100 +0100">
</head>
<body>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>/</span>
<span class=logo__text>alhuelamo.com</span>
<span class=logo__cursor style=visibility:hidden>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/posts/>Posts</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
6 minutes
</p>
</div>
<article>
<h1 class=post-title>
<a href=https://alhuelamo.com/posts/2021/11/native-apple-silicon-jdks/>Native Apple Silicon JDKs</a>
</h1>
<div class=post-content>
<figure><img src=/img/joey-banks-F0otTOnRYUU-unsplash.jpg alt="Photo by Joey Banks in Unsplash"><figcaption>
<p>Photo by <a href=https://unsplash.com/@joeyabanks>Joey Banks</a> in <a href=https://unsplash.com/s/photos/m1-apple>Unsplash</a></p>
</figcaption>
</figure>
<p>I bought an M1 Mac Mini, and I have been using it as my main personal desktop — games aside — for the last months. I&rsquo;m extreamly pleased with this machine: it&rsquo;s small, it feels fast and snappy, it&rsquo;s quiet — I have never ever heard the fans — and its power consumption <a href=https://support.apple.com/en-us/HT201897>is very low</a>.</p>
<p>Apple&rsquo;s plan is to carry out a 2-year transition from November 2020 to replace its Intel-based Macs by M-something ones. Changing base architectures is a challenging process, and one would expect it to be quite painful for users: early adopters should expect compatibility issues with applications, frameworks, or other kinds of software. However, Apple managed to smooth the process by introducing the Rosetta 2 compatibility layer. The &lsquo;2&rsquo; means that this is not a new concept: they already released the first version of Rosetta when they <a href=https://en.wikipedia.org/wiki/Mac_transition_to_Intel_processors>transitioned from PowerPC</a> back in 2005. Rosetta 2 reimplements the same concept for the ongoing transition, which is that Intel based applications may run seamlessly on Apple Silicon based Macs with no significant performance penalties. For my particular use case this has worked very well. I could ran eveything I needed, even if it was not released for M1 processors yet, with no major impact in performance, if any.</p>
<h1 id=jdks-and-rosetta-2>JDKs and Rosetta 2</h1>
<p>The JVM is no exception.</p>
<p>When I started using my brand new Mac Mini, one of the first things I installed was <a href=https://sdkman.io>SDKMAN</a>, a package manager I used for my basic JVM tooling. First things first, I installed Adopt OpenJDK 11 — since 11 is the version we use at work for most of our data pipelines — and boom, there was it: <code>java -version</code> worked, no questions asked, and it didn&rsquo;t feel slower than in my corporate Intel-powered Macbook Pro. So, I was happy.</p>
<p>Then some time passed, and after speaking with some collegues, I realized of one — not so obvious — thing: I was not using an Apple-Silicon-native JDK — I would argue this is another symptom of how well Rosetta 2 works, because I was actually fine with performance of my processes. You know, Java is not well know for its faster startup times, so the fact that SBT took 1 or 2 seconds to start up was not out of place. However, it could be better.</p>
<p>In SDKMAN you can run</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>sdk list java
</code></pre></div><p>which shows a table of the available JDK versions. Here is a portion of that table:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>================================================================================
Available Java Versions
================================================================================
 Vendor        | Use | Version      | Dist    | Status     | Identifier
--------------------------------------------------------------------------------
 AdoptOpenJDK  |     | 16.0.1.j9    | adpt    |            | 16.0.1.j9-adpt
               |     | 16.0.1.hs    | adpt    |            | 16.0.1.hs-adpt
               |     | 11.0.11.j9   | adpt    |            | 11.0.11.j9-adpt
               |     | 11.0.11.hs   | adpt    |            | 11.0.11.hs-adpt
               |     | 8.0.292.j9   | adpt    |            | 8.0.292.j9-adpt
               |     | 8.0.292.hs   | adpt    |            | 8.0.292.hs-adpt
 Corretto      |     | 17.0.1.12.1  | amzn    |            | 17.0.1.12.1-amzn
               |     | 17.0.0.35.2  | amzn    |            | 17.0.0.35.2-amzn
               |     | 16.0.2.7.1   | amzn    |            | 16.0.2.7.1-amzn
               |     | 11.0.13.8.1  | amzn    |            | 11.0.13.8.1-amzn
               |     | 11.0.12.7.2  | amzn    |            | 11.0.12.7.2-amzn
               |     | 8.312.07.1   | amzn    |            | 8.312.07.1-amzn
               |     | 8.302.08.1   | amzn    |            | 8.302.08.1-amzn
</code></pre></div><p>You can see there is nothing indicating whether each JDK is Intel or Apple Silicon native.</p>
<h2 id=filtering-m1-native-jdks>Filtering M1-native JDKs</h2>
<p>After doing some <del>thorough</del> <a href=https://github.com/sdkman/sdkman-cli/issues/830>research</a> I found out we can tell SDKMAN — version 5.10.0+ — to filter out non-native packages. In the file <code>~/.sdkman/etc/config</code> we can set the following setting:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>sdkman_rosetta2_compatible=false
</code></pre></div><p>Which by default is set to true. Then, we can open a new terminal to reload SDKMAN and run the same previous query:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-txt data-lang=txt>================================================================================
Available Java Versions
================================================================================
 Vendor        | Use | Version      | Dist    | Status     | Identifier
--------------------------------------------------------------------------------
 Corretto      |     | 17.0.1.12.1  | amzn    |            | 17.0.1.12.1-amzn
               |     | 17.0.0.35.2  | amzn    |            | 17.0.0.35.2-amzn
 Java.net      |     | 18.ea.25     | open    |            | 18.ea.25-open
               |     | 18.ea.24     | open    |            | 18.ea.24-open
               |     | 18.ea.6.lm   | open    |            | 18.ea.6.lm-open
               |     | 18.ea.5.lm   | open    |            | 18.ea.5.lm-open
               |     | 17           | open    |            | 17-open
               |     | 17.0.1       | open    |            | 17.0.1-open
 Liberica      |     | 17.0.1.fx    | librca  |            | 17.0.1.fx-librca
               |     | 17.0.1       | librca  |            | 17.0.1-librca
               |     | 17.0.0.fx    | librca  |            | 17.0.0.fx-librca
               |     | 17.0.0       | librca  |            | 17.0.0-librca
               |     | 16.0.2       | librca  |            | 16.0.2-librca
               |     | 11.0.13      | librca  |            | 11.0.13-librca
               |     | 11.0.12      | librca  |            | 11.0.12-librca
               |     | 8.0.312      | librca  |            | 8.0.312-librca
               |     | 8.0.302      | librca  |            | 8.0.302-librca
 Microsoft     |     | 17.0.1       | ms      |            | 17.0.1-ms
               |     | 17.0.0       | ms      |            | 17.0.0-ms
               |     | 16.0.2.7.1   | ms      |            | 16.0.2.7.1-ms
 Oracle        |     | 17.0.1       | oracle  |            | 17.0.1-oracle
               |     | 17.0.0       | oracle  |            | 17.0.0-oracle
 SapMachine    |     | 17           | sapmchn |            | 17-sapmchn
               |     | 17.0.1       | sapmchn |            | 17.0.1-sapmchn
 Temurin       |     | 17.0.1       | tem     |            | 17.0.1-tem
               |     | 17.0.0       | tem     |            | 17.0.0-tem
 Zulu          |     | 17.0.1       | zulu    |            | 17.0.1-zulu
               |     | 17.0.1.fx    | zulu    |            | 17.0.1.fx-zulu
               |     | 17.0.0       | zulu    |            | 17.0.0-zulu
               |     | 17.0.0.fx    | zulu    |            | 17.0.0.fx-zulu
               |     | 16.0.2       | zulu    |            | 16.0.2-zulu
               |     | 11.0.13      | zulu    |            | 11.0.13-zulu
               |     | 11.0.12      | zulu    |            | 11.0.12-zulu
               |     | 8.0.312      | zulu    |            | 8.0.312-zulu
               |     | 8.0.302      | zulu    |            | 8.0.302-zulu
================================================================================
</code></pre></div><p>We can see some differences, for instance, <code>AdoptOpenJDK</code> lines are gone.</p>
<h1 id=performance-boost>Performance boost</h1>
<p>I decided to give a try to Zulu JDK 11, and so I installed Zulu JDK 11. The first I did after was to start up sbt on my Scala playground project. SBT usually takes several seconds to boot up, but even with that I could notice it was substancially faster than with the non-native JDK.</p>
<p>I decided then to run a very simple experiment: I would run <code>sbt clean compile</code> for 10 times and then I would compute the average.</p>
<p>These were the results.</p>
<table>
<thead>
<tr>
<th>JDK</th>
<th>Version</th>
<th>Platform</th>
<th>Average time for 10 runs</th>
</tr>
</thead>
<tbody>
<tr>
<td>AdoptOpenJDK</td>
<td>11.0.11</td>
<td>x86-64</td>
<td>24.524 seconds</td>
</tr>
<tr>
<td>Temurin</td>
<td>17.0.1</td>
<td>Apple Silicon</td>
<td>11.804 seconds</td>
</tr>
<tr>
<td>Zulu</td>
<td>11.0.13</td>
<td>Apple Silicon</td>
<td>12.912 seconds</td>
</tr>
<tr>
<td>Liberica</td>
<td>11.0.13</td>
<td>Apple Silicon</td>
<td>14.170 seconds</td>
</tr>
</tbody>
</table>
<p>The results show how native JDKs can better leverage these new Apple ships. In this silly experiment, Zulu turned out to be twice as fast as the AdoptJDK running on Rosetta 2, while Temurin JDK 17, the new name for AdoptOpenJDK, which also features the <a href=https://www.optaplanner.org/blog/2021/09/15/HowMuchFasterIsJava17.html>latests performance upgrades</a>, is even faster. However, the gratest gains result from running the platform native JDKs.</p>
<h1 id=conclusion>Conclusion</h1>
<p>This Apple&rsquo;s hardware architecture transition is resulting so smooth it fooled me: Rosetta 2 did not make noticeable I wasn&rsquo;t using a non-native framework, but after discovering <em>the truth</em>, boy am I happy. SBT feels snappier, so as bloop and other tooling. We just need to choose the right version of our tools for the platform we work on.</p>
</div>
</article>
<hr>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://alhuelamo.com/tags/mac/>mac</a></span>
<span class=tag><a href=https://alhuelamo.com/tags/jvm/>jvm</a></span>
<span class=tag><a href=https://alhuelamo.com/tags/jdk/>jdk</a></span>
<span class=tag><a href=https://alhuelamo.com/tags/sdkman/>sdkman</a></span>
<span class=tag><a href=https://alhuelamo.com/tags/scala/>scala</a></span>
<span class=tag><a href=https://alhuelamo.com/tags/sbt/>sbt</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-folder meta-icon"><path d="M22 19a2 2 0 01-2 2H4a2 2 0 01-2-2V5a2 2 0 012-2h5l2 3h9a2 2 0 012 2z"/></svg>
<span class=tag><a href=https://alhuelamo.com/categories/tooling/>tooling</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
1170 Words
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2021-11-29
</p>
</div>
</main>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=footer__content>
<span>© Alberto Huélamo</span><span><a href=http://github.com/alhuelamo>github</a></span><span><a href=http://twitter.com/alhuelamo>twitter</a></span><span><a href=https://www.linkedin.com/in/alhuelamo/>linkedin</a></span>
</div>
</div>
<div class=footer__inner>
<div class=footer__content>
<span>Powered by <a href=http://gohugo.io>Hugo</a></span><span>Theme by <a href=https://github.com/rhazdon>Djordje Atlialp</a></span>
</div>
</div>
</footer>
</div>
<script type=text/javascript src=/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>
</body>
</html>